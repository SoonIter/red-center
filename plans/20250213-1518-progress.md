# çº¢ä¸­ (Red Center) - å®æ–½è¿›åº¦è®°å½•

## ç¯å¢ƒä¿¡æ¯
- Rust 1.93.1 (stable)
- Bevy 0.18.0
- åƒç´ å­—ä½“: assets/fonts/pixel.ttf (Zpix v3.1.8)

## Bevy 0.18 vs 0.17 API å˜æ›´è®°å½• (è¸©è¿‡çš„å‘)

1. **WindowResolution**: ä¸å†æ”¯æŒ `(f64, f64).into()`, éœ€è¦ç”¨ `(u32, u32).into()`
2. **Msaa**: ä¸å†æ˜¯ Resource, å˜æˆäº† Component, éœ€è¦æŒ‚åœ¨ Camera å®ä½“ä¸Š
3. **ChildSpawner ç±»å‹å˜æ›´**: `EntityCommands::with_children()` å›è°ƒå‚æ•°ç±»å‹ä» `ChildSpawner` å˜ä¸º `ChildSpawnerCommands`
   - `ChildSpawner` = `RelatedSpawner<'w, ChildOf>` (ç”¨äº World ç›´æ¥æ“ä½œ)
   - `ChildSpawnerCommands` = `RelatedSpawnerCommands<'w, ChildOf>` (ç”¨äº Commands æ“ä½œ)
   - **ä¸åœ¨ prelude ä¸­**, éœ€è¦ä» `bevy::ecs::hierarchy::ChildSpawnerCommands` å¯¼å…¥
4. **Sprite**: ç”¨ `Sprite::from_color(color, size)` åˆ›å»ºçº¯è‰²çŸ©å½¢
5. **Text2d**: ä¸–ç•Œç©ºé—´æ–‡å­—, `Text2d::new("text")`, è‡ªåŠ¨ require TextFont/TextColor/Transform ç­‰
6. **UI Text**: UI ä¸­ç”¨ `Text::new("text")`, ä¸æ˜¯ Text2d
7. **Observer æ¨¡å¼**: Event å¿…é¡» derive `Clone`, ç”¨ `commands.trigger()` è§¦å‘, `add_observer()` æ³¨å†Œ

## å·²å®Œæˆ

### Phase 1: é¡¹ç›®éª¨æ¶ä¸çŠ¶æ€æœº âœ…
- [x] Cargo.toml (bevy 0.18, rand 0.8)
- [x] src/main.rs - çª—å£ 1280x720, ImagePlugin::default_nearest(), æ ‡é¢˜ "çº¢ä¸­ Red Center"
- [x] src/plugins/mod.rs - RedCenterPluginGroup
- [x] src/plugins/game.rs - AppState {Menu, Playing, GameOver}, PlayPhase {Selecting, Scoring, RoundResult}, Camera2d + Msaa::Off
- [x] src/plugins/{tile,board,input,scoring,ui}.rs - ç©º Plugin éª¨æ¶
- [x] src/components/mod.rs, tile.rs, board.rs, game.rs
- [x] src/events.rs - æ‰€æœ‰äº‹ä»¶å®šä¹‰
- [x] src/resources.rs - GameState, TileWall, PlayerHand, PlayBoard, SubRound
- [x] cargo check é€šè¿‡

### Phase 2: éº»å°†ç‰Œæ•°æ®æ¨¡å‹ä¸æ¸²æŸ“ âœ…
- [x] components/tile.rs - TileSuit, TileId (label/suit_color/to_index/from_index), Tile, TileLocation, TileSelected
- [x] Tile::generate_full_set() ç”Ÿæˆ 136 å¼ ç‰Œ
- [x] plugins/tile.rs - spawn_tiles (136 ä¸ª Sprite å®ä½“ + Text2d å­å®ä½“), update_tile_positions
- [x] èµ„æºåˆå§‹åŒ–: TileWall, PlayerHand, PlayBoard
- [x] å¼€å±€ä»ç‰Œå±±æ‘¸ hand_size å¼ åˆ°å¾…é€‰åŒº
- [x] cargo check é€šè¿‡

### Phase 3: UI å¸ƒå±€ (è¿›è¡Œä¸­, ~90% å®Œæˆ) ğŸ”§
- [x] plugins/ui.rs - å®Œæ•´ UI ä»£ç å·²å†™å¥½:
  - [x] èœå•é¡µ: æ ‡é¢˜ "çº¢ä¸­" + "å¼€å§‹æ¸¸æˆ" æŒ‰é’®
  - [x] æ¸¸æˆé¡µ: å°ä¸‘åŒº / å¾—åˆ†åŒº / å‡ºç‰ŒåŒº(14ä¸ªç©ºæ§½) / ç‰Œå±± / å¾…é€‰åŒº / æŒ‰é’®è¡Œ(èœå•/å‡ºç‰Œ/å¼ƒç‰Œ)
  - [x] æ¸¸æˆç»“æŸé¡µ: "æ¸¸æˆç»“æŸ" + å…³å¡ä¿¡æ¯ + "é‡æ–°å¼€å§‹" æŒ‰é’®
  - [x] æŒ‰é’®äº‹ä»¶å¤„ç†: menu_button_system, game_button_system, gameover_button_system
  - [x] åˆ†æ•°æ˜¾ç¤ºæ›´æ–°: update_score_display, update_wall_count
  - [x] çŠ¶æ€æ¸…ç†: OnExit cleanup ç³»ç»Ÿ

**å½“å‰é˜»å¡é—®é¢˜**: `ChildSpawnerCommands` ç±»å‹å¯¼å…¥é—®é¢˜
- å·²å°†å‡½æ•°å‚æ•°ä» `ChildSpawner` æ”¹ä¸º `ChildSpawnerCommands`
- éœ€è¦æ‰¾åˆ°æ­£ç¡®çš„ import è·¯å¾„ (ä¸åœ¨ bevy::prelude ä¸­)
- å¯èƒ½çš„è·¯å¾„: `bevy::ecs::hierarchy::ChildSpawnerCommands` æˆ– `bevy::hierarchy::ChildSpawnerCommands`
- **ä¿®å¤æ–¹æ¡ˆ**: åœ¨ ui.rs é¡¶éƒ¨æ·»åŠ  `use bevy::ecs::hierarchy::ChildSpawnerCommands;` ç„¶å cargo check éªŒè¯

## å¾…å®Œæˆ

### Phase 3 å‰©ä½™å·¥ä½œ
1. è§£å†³ ChildSpawnerCommands å¯¼å…¥é—®é¢˜ â†’ cargo check é€šè¿‡
2. cargo run éªŒè¯ UI æ˜¾ç¤º

### Phase 4: æ ¸å¿ƒæ¸¸æˆå¾ªç¯
- plugins/input.rs: handle_tile_click (é¼ æ ‡åæ ‡â†’ä¸–ç•Œåæ ‡â†’AABBç¢°æ’â†’é€‰ç‰Œ)
- plugins/board.rs:
  - on_play_tiles (observer): é€‰ä¸­ç‰Œ Handâ†’Board, è¡¥ç‰Œ, plays_remaining--
  - on_discard_tiles (observer): é€‰ä¸­ç‰Œ Handâ†’Discarded, è¡¥ç‰Œ, discards_remaining--
  - check_phase_transition: 14å¼ æ»¡ or plays==0 â†’ Scoring
- ç‰Œé€‰ä¸­è§†è§‰åé¦ˆ (ä¸Šç§»15px, å·²åœ¨ update_tile_positions ä¸­å®ç°)

### Phase 5: å’Œç‰Œåˆ¤å®šä¸è®¡åˆ†
- plugins/scoring.rs:
  - `evaluate_hand(tiles: &[TileId]) -> HandResult` çº¯å‡½æ•°
  - [u8; 34] è®¡æ•°æ•°ç»„ + é€’å½’å›æº¯
  - ç‰Œå‹: å¹³å’Œ(Ã—1), æ–­å¹ºä¹(Ã—2), ä¸€æ°”é€šè´¯(Ã—3), å¯¹å¯¹å’Œ(Ã—4), æ··ä¸€è‰²(Ã—5), æ¸…ä¸€è‰²(Ã—8), ä¸ƒå¯¹å­(Ã—4), å›½å£«æ— åŒ(Ã—13)
  - calculate_score ç³»ç»Ÿ (OnEnter Scoring)
  - å•å…ƒæµ‹è¯•

### Phase 6: Roguelike å…³å¡è¿›åº¦
- ç›²æ³¨ç³»ç»Ÿ: å°ç›²æ³¨(100Ã—N) / å¤§ç›²æ³¨(200Ã—N) / Boss(400Ã—N)
- advance_sub_round / advance_level
- å°å…³åˆ‡æ¢: æ¸…ç©ºå‡ºç‰ŒåŒº, ç‰Œå±±ä¿ç•™
- è¿‡å…³: é‡æ–°ç”Ÿæˆ 136 å¼ ç‰Œ
- å¤±è´¥: â†’ GameOver
- å°å…³å¼€å§‹æ¨ªå¹…åŠ¨ç”» (å¯é€‰)

## é¡¹ç›®æ–‡ä»¶ç»“æ„ (å½“å‰)
```
red-center/
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ assets/fonts/pixel.ttf
â”œâ”€â”€ plans/
â”‚   â”œâ”€â”€ structure.png          # UI åŸå‹å›¾
â”‚   â””â”€â”€ progress.md            # æœ¬æ–‡ä»¶
â””â”€â”€ src/
    â”œâ”€â”€ main.rs
    â”œâ”€â”€ events.rs
    â”œâ”€â”€ resources.rs
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”œâ”€â”€ tile.rs
    â”‚   â”œâ”€â”€ board.rs
    â”‚   â””â”€â”€ game.rs
    â””â”€â”€ plugins/
        â”œâ”€â”€ mod.rs
        â”œâ”€â”€ game.rs
        â”œâ”€â”€ tile.rs
        â”œâ”€â”€ board.rs            # ç©ºéª¨æ¶
        â”œâ”€â”€ input.rs            # ç©ºéª¨æ¶
        â”œâ”€â”€ scoring.rs          # ç©ºéª¨æ¶
        â””â”€â”€ ui.rs
```
